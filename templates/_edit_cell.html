<tr id="row-{{ part.uuid }}">
    {# Description #}
    {% if field == "description" %}
    <td class="cell" data-label="Description">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/description" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get('description','') }}" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Description" hx-get="/parts/{{ part.uuid }}/edit/description" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.description }}</td>
    {% endif %}

    {# Package #}
    {% if field == "package" %}
    <td class="cell" data-label="Package">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/package" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get('package','') }}" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Package" hx-get="/parts/{{ part.uuid }}/edit/package" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.package }}</td>
    {% endif %}

    {# Container #}
    {% if field == "container_id" %}
    <td class="cell" data-label="Container">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/container_id" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <select name="value" autofocus>
                <option value="" {% if not (part.container_id and part.container_id|trim) %}selected{% endif %}>â€”</option>
                {% for c in containers %}
                {% set code = c.code if c.code is defined else c %}
                <option value="{{ code }}" {% if code==part.container_id %}selected{% endif %}>{{ code }}</option>
                {% endfor %}
            </select>
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Container" hx-get="/parts/{{ part.uuid }}/edit/container_id" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
        {% if part.container_id and part.container_id|trim %}
        <a class="chip chip-link" href="/containers/{{ part.container_id|urlencode }}" onclick="event.stopPropagation();" title="Open container {{ part.container_id }}">{{ part.container_id }}</a>
        {% else %}
        <span class="chip muted">â€”</span>
        {% endif %}
    </td>
    {% endif %}

    {# Qty #}
    {% if field == "quantity" %}
    <td class="cell mono" data-label="Qty">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/quantity" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get('quantity', 0) }}" type="number" min="0" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell mono" data-label="Qty" hx-get="/parts/{{ part.uuid }}/edit/quantity" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.quantity }}</td>
    {% endif %}

    {# Notes #}
    {% if field == "notes" %}
    <td class="cell" data-label="Notes">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/notes" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get('notes','') }}" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Notes" hx-get="/parts/{{ part.uuid }}/edit/notes" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.notes }}</td>
    {% endif %}

    {# Category #}
    {% if field == "category" %}
    <td class="cell" data-label="Category">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/category" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <select name="value" autofocus>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if cat==part.category %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
            </select>
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Category" hx-get="/parts/{{ part.uuid }}/edit/category" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.category }}</td>
    {% endif %}

    {# Subcategory #}
    {% if field == "subcategory" %}
    <td class="cell" data-label="Subcategory">
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/subcategory" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get('subcategory','') }}" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
    </td>
    {% else %}
    <td class="cell" data-label="Subcategory" hx-get="/parts/{{ part.uuid }}/edit/subcategory" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">{{ part.subcategory }}</td>
    {% endif %}

    <td class="actions" data-label="Actions">
        {% if field in ["datasheet_url", "pinout_url", "image_url"] %}
        <form class="edit" hx-post="/parts/{{ part.uuid }}/edit/{{ field }}" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML">
            <input name="value" value="{{ part.get(field, '') }}" type="text" inputmode="url" placeholder="/static/images/â€¦ or https://â€¦" autofocus />
            <button class="btn secondary icon icon-lg" type="submit" title="Save" aria-label="Save">
                <img src="/static/icons/Green_Checkmark_Circle.svg" alt="" aria-hidden="true" />
            </button>
            <button class="btn secondary icon icon-lg" type="button" hx-get="/partials/table" hx-target="#table" hx-swap="innerHTML" title="Cancel" aria-label="Cancel">
                <img src="/static/icons/Red_Cancel_Circle.svg" alt="" aria-hidden="true" />
            </button>
        </form>
        {% else %}
            {# Keep the actions consistent with the normal row #}
            {% set image_url = part.get("image_url", "") %}
            {% if image_url and image_url|trim %}
            <a class="btn secondary icon" href="{{ image_url }}" target="_blank" rel="noopener" title="Open device image" aria-label="Open device image">
                <img src="/static/icons/IC_SMD16SQ_filled.svg" alt="" aria-hidden="true" />
            </a>
            {% else %}
            <button class="btn secondary icon" hx-get="/parts/{{ part.uuid }}/edit/image_url" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML" title="Add device image" aria-label="Add device image">
                <img src="/static/icons/IC_SMD16SQ_filled.svg" alt="" aria-hidden="true" />
            </button>
            {% endif %}

            {% set pinout_url = part.get("pinout_url", "") %}
            {% if pinout_url and pinout_url|trim %}
            <a class="btn secondary icon" href="{{ pinout_url }}" target="_blank" rel="noopener" title="Open pinout" aria-label="Open pinout">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
                        <rect x="7" y="5" width="10" height="14" rx="1.2" />
                        <path d="M10 5.2c.4 1.2 1.3 2 2 2s1.6-.8 2-2" />
                        <path d="M7 8H5" />
                        <path d="M7 11H5" />
                        <path d="M7 14H5" />
                        <path d="M7 17H5" />
                        <path d="M19 8H17" />
                        <path d="M19 11H17" />
                        <path d="M19 14H17" />
                        <path d="M19 17H17" />
                    </g>
                </svg>
            </a>
            {% else %}
            <button class="btn secondary icon" hx-get="/parts/{{ part.uuid }}/edit/pinout_url" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML" title="Add pinout link" aria-label="Add pinout link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
                        <rect x="7" y="5" width="10" height="14" rx="1.2" />
                        <path d="M10 5.2c.4 1.2 1.3 2 2 2s1.6-.8 2-2" />
                        <path d="M7 8H5" />
                        <path d="M7 11H5" />
                        <path d="M7 14H5" />
                        <path d="M7 17H5" />
                        <path d="M19 8H17" />
                        <path d="M19 11H17" />
                        <path d="M19 14H17" />
                        <path d="M19 17H17" />
                    </g>
                </svg>
            </button>
            {% endif %}

            {% if part.get("datasheet_url") and part.get("datasheet_url")|trim %}
            <a class="btn secondary icon" href="{{ part.get('datasheet_url') }}" target="_blank" rel="noopener" title="Open datasheet">ðŸ“„</a>
            {% else %}
            <button class="btn secondary icon" hx-get="/parts/{{ part.uuid }}/edit/datasheet_url" hx-target="#row-{{ part.uuid }}" hx-swap="outerHTML" title="Add datasheet link">ðŸ“„</button>
            {% endif %}

            <span class="hover-preview">
                <button class="btn secondary icon" type="button" title="Show timestamps" aria-label="Show timestamps">
                    <img src="/static/icons/Information_icon.svg" alt="" aria-hidden="true" />
                </button>
                <span class="hover-preview__bubble" role="tooltip">
                    <div>
                        <div><strong>Created:</strong> <span class="mono ts">{{ part.get('created_at_local') or part.get('created_at') or 'â€”' }}</span></div>
                        <div><strong>Updated:</strong> <span class="mono ts">{{ part.get('updated_at_local') or part.get('updated_at') or 'â€”' }}</span></div>
                        <div><strong>Links:</strong>
                            Image: {{ 'yes' if (part.get('image_url') or '')|trim else 'no' }},
                            Pinout: {{ 'yes' if (part.get('pinout_url') or '')|trim else 'no' }},
                            Datasheet: {{ 'yes' if (part.get('datasheet_url') or '')|trim else 'no' }}
                        </div>
                        <div><strong>UUID:</strong> <span class="mono">{{ part.get('uuid') or 'â€”' }}</span></div>
                    </div>
                </span>
            </span>

            <form hx-post="/parts/{{ part.uuid }}/delete" hx-target="#table" hx-swap="innerHTML" hx-confirm="Delete this part?">
                <button class="btn secondary icon danger-outline" type="submit" title="Delete" aria-label="Delete">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" aria-hidden="true"><path fill="currentColor" d="M5 3h2a1 1 0 0 0-2 0ZM4 3a2 2 0 1 1 4 0h2.5a.5.5 0 0 1 0 1h-.441l-.443 5.17A2 2 0 0 1 7.623 11H4.377a2 2 0 0 1-1.993-1.83L1.941 4H1.5a.5.5 0 0 1 0-1H4Zm3.5 3a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0V6ZM5 5.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5ZM3.38 9.085a1 1 0 0 0 .997.915h3.246a1 1 0 0 0 .996-.915L9.055 4h-6.11l.436 5.085Z"/></svg>
                </button>
            </form>
        {% endif %}
    </td>
</tr>