{% extends "base.html" %}
{% block content %}

<section class="panel">
    <h2>Container {{ code }}</h2>

    {% if parts %}
    <table class="tbl">
        <thead>
            <tr>
                <th>Description</th>
                <th>Package</th>
                <th>Notes</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Subcategory</th>
                <th>UUID</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for p in parts %}
            <tr id="row-{{ p.uuid }}">
                <td>{{ p.description }}</td>
                <td>{{ p.package }}</td>
                <td class="notes">{{ p.notes }}</td>
                <td class="mono">{{ p.quantity }}</td>
                <td>{{ p.category }}</td>
                <td>{{ p.subcategory }}</td>
                <td class="mono uuid">{{ p.uuid }}</td>

                <td class="actions">
                    {# Datasheet #}
                    {% set datasheet_url = p.get("datasheet_url", "") %}
                    {% if datasheet_url and datasheet_url|trim %}
                    <span class="hover-preview">
                        <a class="btn secondary icon" href="{{ datasheet_url }}" target="_blank" rel="noopener" title="Open datasheet" aria-label="Open datasheet">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M13 9h5.5L13 3.5zM6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m4.93 10.44c.41.9.93 1.64 1.53 2.15l.41.32c-.87.16-2.07.44-3.34.93l-.11.04l.5-1.04c.45-.87.78-1.66 1.01-2.4m6.48 3.81c.18-.18.27-.41.28-.66c.03-.2-.02-.39-.12-.55c-.29-.47-1.04-.69-2.28-.69l-1.29.07l-.87-.58c-.63-.52-1.2-1.43-1.6-2.56l.04-.14c.33-1.33.64-2.94-.02-3.6a.85.85 0 0 0-.61-.24h-.24c-.37 0-.7.39-.79.77c-.37 1.33-.15 2.06.22 3.27v.01c-.25.88-.57 1.9-1.08 2.93l-.96 1.8l-.89.49c-1.2.75-1.77 1.59-1.88 2.12c-.04.19-.02.36.05.54l.03.05l.48.31l.44.11c.81 0 1.73-.95 2.97-3.07l.18-.07c1.03-.33 2.31-.56 4.03-.75c1.03.51 2.24.74 3 .74c.44 0 .74-.11.91-.3m-.41-.71l.09.11c-.01.1-.04.11-.09.13h-.04l-.19.02c-.46 0-1.17-.19-1.9-.51c.09-.1.13-.1.23-.1c1.4 0 1.8.25 1.9.35M7.83 17c-.65 1.19-1.24 1.85-1.69 2c.05-.38.5-1.04 1.21-1.69zm3.02-6.91c-.23-.9-.24-1.63-.07-2.05l.07-.12l.15.05c.17.24.19.56.09 1.1l-.03.16l-.16.82z"/></svg>
                        </a>
                        <span class="hover-preview__bubble" role="tooltip">
                            <a class="btn secondary" href="{{ datasheet_url }}" target="_blank" rel="noopener" title="Open datasheet">Open</a>
                        </span>
                    </span>
                    {% else %}
                    <span class="btn secondary icon" title="No datasheet" aria-label="No datasheet" aria-disabled="true" style="opacity:.45; cursor:default;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M13 9h5.5L13 3.5zM6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m4.93 10.44c.41.9.93 1.64 1.53 2.15l.41.32c-.87.16-2.07.44-3.34.93l-.11.04l.5-1.04c.45-.87.78-1.66 1.01-2.4m6.48 3.81c.18-.18.27-.41.28-.66c.03-.2-.02-.39-.12-.55c-.29-.47-1.04-.69-2.28-.69l-1.29.07l-.87-.58c-.63-.52-1.2-1.43-1.6-2.56l.04-.14c.33-1.33.64-2.94-.02-3.6a.85.85 0 0 0-.61-.24h-.24c-.37 0-.7.39-.79.77c-.37 1.33-.15 2.06.22 3.27v.01c-.25.88-.57 1.9-1.08 2.93l-.96 1.8l-.89.49c-1.2.75-1.77 1.59-1.88 2.12c-.04.19-.02.36.05.54l.03.05l.48.31l.44.11c.81 0 1.73-.95 2.97-3.07l.18-.07c1.03-.33 2.31-.56 4.03-.75c1.03.51 2.24.74 3 .74c.44 0 .74-.11.91-.3m-.41-.71l.09.11c-.01.1-.04.11-.09.13h-.04l-.19.02c-.46 0-1.17-.19-1.9-.51c.09-.1.13-.1.23-.1c1.4 0 1.8.25 1.9.35M7.83 17c-.65 1.19-1.24 1.85-1.69 2c.05-.38.5-1.04 1.21-1.69zm3.02-6.91c-.23-.9-.24-1.63-.07-2.05l.07-.12l.15.05c.17.24.19.56.09 1.1l-.03.16l-.16.82z"/></svg>
                    </span>
                    {% endif %}

                    {# Device image #}
                    {% set image_url = p.get("image_url", "") %}
                    {% if image_url and image_url|trim %}
                    {% set image_url_l = image_url|lower %}
                    {% if image_url_l.endswith('.png')
                          or image_url_l.endswith('.jpg')
                          or image_url_l.endswith('.jpeg')
                          or image_url_l.endswith('.gif')
                          or image_url_l.endswith('.webp')
                          or image_url_l.endswith('.svg') %}
                    <span class="hover-preview">
                        <a class="btn secondary icon" href="{{ image_url }}" target="_blank" rel="noopener" title="Open device image" aria-label="Open device image">
                            <img src="/static/icons/IC_SMD16SQ_filled.svg" alt="" aria-hidden="true" />
                        </a>
                        <span class="hover-preview__bubble" role="tooltip">
                            <a href="{{ image_url }}" target="_blank" rel="noopener" title="Open device image">
                                <img class="hover-preview__img" src="{{ image_url }}" alt="Device image preview" loading="lazy" />
                            </a>
                        </span>
                    </span>
                    {% else %}
                    <span class="hover-preview">
                        <a class="btn secondary icon" href="{{ image_url }}" target="_blank" rel="noopener" title="Open device image" aria-label="Open device image">
                            <img src="/static/icons/IC_SMD16SQ_filled.svg" alt="" aria-hidden="true" />
                        </a>
                        <span class="hover-preview__bubble" role="tooltip">
                            <a class="btn secondary" href="{{ image_url }}" target="_blank" rel="noopener" title="Open device image">Open</a>
                        </span>
                    </span>
                    {% endif %}
                    {% else %}
                    <span class="btn secondary icon" title="No device image" aria-label="No device image" aria-disabled="true" style="opacity:.45; cursor:default;">
                        <img src="/static/icons/IC_SMD16SQ_filled.svg" alt="" aria-hidden="true" />
                    </span>
                    {% endif %}

                    {# Pinout #}
                    {% set pinout_url = p.get("pinout_url", "") %}
                    {% if pinout_url and pinout_url|trim %}
                    {% set pinout_url_l = pinout_url|lower %}
                    <span class="hover-preview">
                        <a class="btn secondary icon" href="{{ pinout_url }}" target="_blank" rel="noopener" title="Open pinout" aria-label="Open pinout">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
                                    <rect x="7" y="5" width="10" height="14" rx="1.2" />
                                    <path d="M10 5.2c.4 1.2 1.3 2 2 2s1.6-.8 2-2" />
                                    <path d="M7 8H5" />
                                    <path d="M7 11H5" />
                                    <path d="M7 14H5" />
                                    <path d="M7 17H5" />
                                    <path d="M19 8H17" />
                                    <path d="M19 11H17" />
                                    <path d="M19 14H17" />
                                    <path d="M19 17H17" />
                                </g>
                            </svg>
                        </a>
                        <span class="hover-preview__bubble" role="tooltip">
                            {% if pinout_url_l.endswith('.png')
                                  or pinout_url_l.endswith('.jpg')
                                  or pinout_url_l.endswith('.jpeg')
                                  or pinout_url_l.endswith('.gif')
                                  or pinout_url_l.endswith('.webp')
                                  or pinout_url_l.endswith('.svg') %}
                            <a href="{{ pinout_url }}" target="_blank" rel="noopener" title="Open pinout">
                                <img class="hover-preview__img" src="{{ pinout_url }}" alt="Pinout preview" loading="lazy" />
                            </a>
                            {% else %}
                            <a class="btn secondary" href="{{ pinout_url }}" target="_blank" rel="noopener" title="Open pinout">Open</a>
                            {% endif %}
                        </span>
                    </span>
                    {% else %}
                    <span class="btn secondary icon" title="No pinout" aria-label="No pinout" aria-disabled="true" style="opacity:.45; cursor:default;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
                                <rect x="7" y="5" width="10" height="14" rx="1.2" />
                                <path d="M10 5.2c.4 1.2 1.3 2 2 2s1.6-.8 2-2" />
                                <path d="M7 8H5" />
                                <path d="M7 11H5" />
                                <path d="M7 14H5" />
                                <path d="M7 17H5" />
                                <path d="M19 8H17" />
                                <path d="M19 11H17" />
                                <path d="M19 14H17" />
                                <path d="M19 17H17" />
                            </g>
                        </svg>
                    </span>
                    {% endif %}

                    {# Delete #}
                    <form method="post" action="/parts/{{ p.uuid }}/delete" onsubmit="return confirm('Delete this part?');">
                        <button class="btn danger icon" type="submit" title="Delete" aria-label="Delete">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" aria-hidden="true"><path fill="currentColor" d="M5 3h2a1 1 0 0 0-2 0ZM4 3a2 2 0 1 1 4 0h2.5a.5.5 0 0 1 0 1h-.441l-.443 5.17A2 2 0 0 1 7.623 11H4.377a2 2 0 0 1-1.993-1.83L1.941 4H1.5a.5.5 0 0 1 0-1H4Zm3.5 3a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0V6ZM5 5.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5ZM3.38 9.085a1 1 0 0 0 .997.915h3.246a1 1 0 0 0 .996-.915L9.055 4h-6.11l.436 5.085Z"/></svg>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="muted">This container is empty.</p>
    {% endif %}
</section>

{% endblock %}